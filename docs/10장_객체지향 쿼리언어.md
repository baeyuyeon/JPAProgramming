## 1. κ°μ²΄μ§€ν–¥ μΏΌλ¦¬ μ†κ°
#### JPQL νΉμ§•
- ν…μ΄λΈ”μ΄ μ•„λ‹ κ°μ²΄λ¥Ό λ€μƒμΌλ΅ κ²€μƒ‰ν•λ” κ°μ²΄μ§€ν–¥ μΏΌλ¦¬λ‹¤.
- SQLμ„ μ¶”μƒν™”ν•΄μ„ νΉμ • λ°μ΄ν„°λ² μ΄μ¤ SQLμ— μμ΅΄ν•μ§€ μ•λ”λ‹¤.

#### JPAκ°€ μ κ³µν•λ” λ‹¤μ–‘ν• κ²€μƒ‰λ°©λ²•
- JPQL
- Criteria μΏΌλ¦¬ : JPQLμ„ νΈν•κ² μ‘μ„±ν•λ„λ΅ λ„μ™€μ£Όλ” API, λΉλ” ν΄λμ¤ λ¨μ
- λ„¤μ΄ν‹°λΈ SQL : JPAμ—μ„ JPQL λ€μ‹  μ§μ ‘ SQLμ„ μ‘μ„±ν•  μ μλ‹¤.
- QueryDSL : λΉ„ν‘μ¤€ μ¤ν”μ†μ¤ ν”„λ μ„μ›ν¬, JPQLμ„ νΈν•κ² μ‘μ„±ν•λ„λ΅ λ„μ™€μ£Όλ” ν΄λμ¤ λ¨μ
- JDBCμ§μ ‘ μ‚¬μ©, Mybatis κ°™μ€ SQL λ§¤νΌ ν”„λ μ„μ›ν¬ μ‚¬μ© : ν•„μ”ν•λ‹¤λ©΄ JDBCμ§μ ‘ μ‚¬μ©

### β“JPQL μ†κ°
JPQL μ€ μ—”ν‹°ν‹° κ°μ²΄λ¥Ό μ΅°νν•λ” κ°μ²΄μ§€ν–¥ μΏΌλ¦¬λ‹¤. λν• JPQLμ€ SQLλ³΄λ‹¤ κ°„κ²°ν•λ‹¤. μ—”ν‹°ν‹° μ§μ ‘ μ΅°ν, λ¬µμ‹μ  μ΅°μΈ, λ‹¤ν•μ„± μ§€μ›μΌλ΅ SQLμ½”λ“κ°€ κ°„κ²°ν•λ‹¤.
```java
@Entity(name = "Member")
public class Member { 
	@Column(name = "name")
    private String username;
    
    //...
}
...
String jpql = "select m from Member as m wher m.username='kim'";
List<Member> resultList = em.createQuery(jpql, Member.class).getResultList();
```

`select m from Member as m wher m.username='kim'` μ—μ„ Memberλ” μ—”ν‹°ν‹° μ΄λ¦„μ΄κ³ , m.usernameμ€ μ—”ν‹°ν‹° κ°μ²΄μ ν•„λ“λ…μ΄λ‹¤.

em.createQuery λ©”μ†λ“μ— μ‹¤ν–‰ν•  JPQLκ³Ό μ—”ν‹°ν‹° ν΄λμ¤ νƒ€μ…μ„ λ„κ²¨μ£Όκ³  getResultListλ¥Ό νΈμ¶ν•λ©΄ JPAλ” JPQLμ„ SQLλ΅ λ³€ν™ν•΄μ„ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ΅°νν•λ‹¤.

### β“Criteria μΏΌλ¦¬ μ†κ°
Criteria λ” JPQL μ„ μƒμ„±ν•λ” λΉλ” ν΄λμ¤λ‹¤. Criteria μ μ¥μ μ€ λ¬Έμκ°€ μ•„λ‹ query.select(m).where(...)μ²λΌ ν”„λ΅κ·Έλλ° μ½”λ“λ΅ JPQLμ„ μ‘μ„±ν•  μ μλ‹¤λ” μ μ΄λ‹¤.
μ¦‰, μ»΄νμΌ μ‹μ μ— μ¤λ¥λ¥Ό ν™•μΈν•  μ μλ‹¤.

κ°„λ‹¨ν• jpql λ¬Έμ΄λ‹¤.
`select m from Member as m where m.username='kim'`
μ΄κ²ƒμ„ Criteria μ½”λ“λ΅ λ³€ν™ν•΄ λ³΄μ.
```java
// Criteria μ‚¬μ© μ¤€λΉ„
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);

//λ£¨νΈ ν΄λμ¤(μ΅°νλ¥Ό μ‹μ‘ν•  ν΄λμ¤)
Root<Member> m =query.from(Member.class);

//μΏΌλ¦¬ μƒμ„±
CriteriaQuery<Member> cq = query.select(m).where(cb.equals(m.get("username"),"kim"));

List<Member> resultList = em.createQuery(cq).getResultList();

```
μ„ μ½”λ“μ—μ„ μ•„μ‰¬μ΄ μ μ€ m.get("username")μΌλ΅ ν•„λ“λ…μ„ λ¬Έμλ΅ μ‘μ„±ν• μ μ΄λ‹¤.
μ΄ λ¶€λ¶„μ€ λ©”νƒ€λ¨λΈμ„ μ‚¬μ©ν•λ©΄ μ½”λ“λ΅ μ‘μ„±ν•  μ μλ‹¤.
```java
//λ©”νƒ€ λ¨λΈ μ‚¬μ© μ „ -> μ‚¬μ© ν›„
m.get("username") -> m.get(Member_.username)
```
Criteria κ°€ μ¥μ μ€ λ§μ§€λ§ μ¥μ μ„ μƒμ‡„ν•  μ •λ„λ΅ λ³µμ΅ν•λ‹¤.. ν•λμ— λ“¤μ–΄μ¤μ§€ μ•λ‹¤.

### β“QueryDSL μ†κ°
QueryDSLλ„ Criteria μ²λΌ JPQL λΉλ” μ—­ν• μ„ ν•λ‹¤. μΆ€ λ” λ‹¨μν•κ³  ν•λμ— λ“¤μ–΄μ¨λ‹¤.
>QueryDSLμ€ JPAν‘μ¤€μ€ μ•„λ‹κ³  μ¤ν”μ†μ¤ ν”„λ΅μ νΈλ‹¤.

```java
//μ¤€λΉ„
JPAQuery query = new JPAQuery(em);
QMember member = QMember.member;

//μΏΌλ¦¬, κ²°κ³Όμ΅°ν
List<Member> members = query.from(member)
					.where(member.username.eq("kim"))
					.list(member);
```

### β“λ„¤μ΄ν‹°λΈ SQLμ†κ°
JPAλ” SQLμ„ μ§μ ‘ μ‚¬μ©ν•  μ μλ” κΈ°λ¥μ„ μ§€μ›ν•λ”λ°, μ΄κ²ƒμ„ λ„¤μ΄ν‹°λΈ SQLμ΄λΌ ν•λ‹¤.
λ‹¨μ μ€, νΉμ • λ°μ΄ν„°λ² μ΄μ¤μ— μμ΅΄ν•λ” SQLμ„ μ‘μ„±ν•΄μ•Όν•λ‹¤λ” κ²ƒμ΄λ‹¤.
```java
String sql = "SELECT ID, NAME FROM MEMBER WHERE NAME='kim'";
List<Member> resultList = em.createNativeQuery(sql, Member.class).getResultList();
```

### β“JDBC μ§μ ‘μ‚¬μ©, λ§μ΄λ°”ν‹°μ¤ κ°™μ€ SQL λ§¤νΌ ν”„λ μ„μ›ν¬ μ‚¬μ©
JDBCλ‚ λ§μ΄λ°”ν‹°μ¤λ¥Ό JPAμ™€ ν•¨κ» μ‚¬μ©ν•λ©΄ μμ†μ„± μ»¨ν…μ¤νΈλ¥Ό μ μ ν• μ‹μ μ— κ°•μ λ΅ ν”λ¬μ‹ν•΄μ•Όν•λ‹¤.
μ)
1. JPAμ—μ„ μμ†μ„± μ»¨ν…μ¤νΈμ—μ„ μƒν’κ°€κ²©μ„ 10,000μ›->9,000μ› μΌλ΅ λ³€κ²½(μ•„μ§ ν”λ¬μ‹ ν•μ§€μ•μ.)
2. JDBCμ—μ„ μ§μ ‘ μƒν’ μ΅°ν -> 10,000μ›μΌλ΅ μ΅°νλ¨.

κ·Έλ¬λ―€λ΅ JPAλ¥Ό μ°νν•΄μ„ SQLμ„ μ‹¤ν–‰ν•κΈ° μ§μ „μ— μμ†μ„± μ»¨ν…μ¤νΈλ¥Ό μλ™μΌλ΅ ν”λ¬μ‹ν•΄μ„ λ°μ΄ν„°λ² μ΄μ¤μ™€ μμ†μ„± μ»¨ν…μ¤νΈλ¥Ό λ™κΈ°ν™”ν•λ©΄ λλ‹¤.

---
## 2. JPQL
μ‹μ‘ν•κΈ° μ „μ— μ΄λ² μ μ—μ„ μμ λ΅ μ‚¬μ©ν•  λ„λ©”μΈ λ¨λΈμ„ μ‚΄ν΄λ³΄μ.

`UML`
![](https://velog.velcdn.com/images/baeyuyeon/post/8c9ffdb4-d0ca-4bd7-9b24-90100eea6e7a/image.png)


`ERD`
![](https://velog.velcdn.com/images/baeyuyeon/post/93660681-b445-4b45-891f-70e7238d5316/image.png)

### π“JPQL κΈ°λ³Έ λ¬Έλ²•
#### SELECTλ¬Έ
`SELECT m FROM Member AS m where m.username = 'HELLO'`

- μ—”ν‹°ν‹°μ™€ μ†μ„±μ€ λ€μ†λ¬Έμλ¥Ό κµ¬λ¶„ν•λ‹¤. λ°λ©΄μ— SELECT, FROM AS κ°™μ€ JPQL ν‚¤μ›λ“λ” λ€μ†λ¬Έμλ¥Ό κµ¬λ¶„ν•μ§€ μ•λ”λ‹¤.
- JPQL μ—μ„ μ‚¬μ©ν• Member λ” ν΄λμ¤λ…μ΄ μ•„λ‹λΌ μ—”ν‹°ν‹° λ…μ΄λ‹¤.
	`@Entity(name="XXX")`λ΅ μ§€μ •ν•  μ μλ‹¤.
- JPQLμ€ λ³„μΉ­μ„ ν•„μλ΅ μ‚¬μ©ν•΄μ•Όν•λ‹¤.
>μ°Έκ³ λ΅ HQLμ„ μ‚¬μ©ν•λ©΄ λ³„μΉ­μ—†μ΄ μ‚¬μ©ν•  μ μλ‹¤.

#### TypeQuery, Query
μ‘μ„±ν• JPQLμ„ μ‹¤ν–‰ν•λ ¤λ©΄ μΏΌλ¦¬ κ°μ²΄λ¥Ό λ§λ“¤μ–΄μ•Όν•λ‹¤.

`TypeQuery` : λ°ν™ν•  νƒ€μ…μ„ λ…ν™•ν•κ² μ§€μ •ν•  μ μμ„ λ• μ‚¬μ©
`Query` : λ°ν™νƒ€μ…μ„ λ…ν™•ν•κ² μ§€μ •ν•  μ μ—†μ„ λ• μ‚¬μ©.

```java
TypeQuery<Member> query = em.createQuery("SELECT m from Member m", Member.class);
List<Member> resultList = query.getResultList();
```
em.createQueryμ— λ‘λ²μ§Έ νλΌλ―Έν„°λ¥Ό μ§€μ •ν•λ©΄ ? TypeQuery λ°ν™
μ§€μ •μ•ν•λ©΄ Query λ°ν™μΌλ΅ λ™μ‘ν•λ‹¤.

```java
Query query = em.createQuery("SELECT m.username, m.age from Member m");
List resutlList = query.getResultList();
```
μ„ μ½”λ“λ¥Ό λ³΄λ©΄, μ΅°ν λ€μƒμ΄ String νƒ€μ…μΈ νμ›μ΄λ¦„κ³Ό Integer νƒ€μ…μΈ λ‚μ΄μ΄λ―€λ΅ μ΅°ν λ€μƒ νƒ€μ…μ΄ λ…ν™•ν•μ§€ μ•λ‹¤. λ”°λΌμ„ Query κ°μ²΄λ¥Ό μ‚¬μ©ν•΄μ•Όν•λ‹¤.

#### κ²°κ³Ό μ΅°ν
- `query.getResultList()` : κ²°κ³Όλ¥Ό μ»¬λ ‰μ…μΌλ΅ λ°ν™ν•λ‹¤.
- `query.getSingleResult()` : κ²°κ³Όκ°€ μ •ν™•ν ν•λ‚μΌ λ• μ‚¬μ©ν•λ‹¤.
	-κ²°κ³Όκ°€ μ—†μΌλ©΄? `javax.persistence.NoResultException` μμ™Έ λ°μƒ
    -κ²°κ³Όκ°€ 1κ° λ³΄λ‹¤ λ§μΌλ©΄? `javax.persistence.NouniqueResultException` μμ™Έ λ°μƒ

### π“νλΌλ―Έν„° λ°”μΈλ”©
JDBC λ” μ„μΉ κΈ°μ¤€ νλΌλ―Έν„° λ°”μΈλ”©λ§ μ§€μ›ν•μ§€λ§, JPQLμ€ μ΄λ¦„ κΈ°μ¤€ νλΌλ―Έν„° λ°”μΈλ”©λ„ μ§€μ›ν•λ‹¤.
#### μ΄λ¦„κΈ°μ¤€ νλΌλ―Έν„° 
`:`λ¥Ό μ‚¬μ©ν•λ‹¤.
```java
TypeQuery<Member> query = em.createQuery(
				"SELECT m from Member m where m.username = :username", Member.class);
query.setParameter("username" , usernameParam);
List<Member> result = query.getResultList();
```
μ°Έκ³ λ΅ JPQL APIλ” λ€λ¶€λ¶„ λ©”μ†λ“ μ²΄μΈ λ°©μ‹μΌλ΅ μ„¤κ³„λμ–΄ μλ‹¤.
```java
List<Member> members = em.createQuery("SELECT m FROM Member m where m.username = :username", Member.class)
						.setParameter("username", usernameParam);
                        .getResultList();
```
μ΄λ ‡κ² μ—°μ†ν•΄μ„ μ‘μ„±μ΄ κ°€λ¥ν•λ‹¤.
#### μ„μΉ κΈ°μ¤€ νλΌλ―Έν„°
μ„μΉκΈ°μ¤€ νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ `?` λ‹¤μμ— μ„μΉ κ°’μ„ μ£Όλ©΄ λλ‹¤.
μ„μΉκ°’μ€ 1λ¶€ν„° μ‹μ‘ν•λ‹¤.
```java
List<Member> members = em.createQuery("SELECT m FROM Member m where m.username = ?1", Member.class)
						.setParameter(1, usernameParam);
                        .getResultList();
```

μ„μΉκΈ°μ¤€ νλΌλ―Έν„° λ°©μ‹λ³΄λ‹¤λ” **μ΄λ¦„κΈ°μ¤€ νλΌλ―Έν„° λ°”μΈλ”© λ°©μ‹μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ λ” λ…ν™•**ν•λ‹¤.
>_**νλΌλ―Έν„° λ°”μΈλ”© λ°©μ‹μ„ λ¬΄μ΅°κ±΄ μ‚¬μ©ν•μ!**_
νλΌλ―Έν„° λ°”μΈλ”© λ°©μ‹μ„ μ‚¬μ©ν•λ©΄ SQL Injection κ³µκ²©μ„ λ§‰μ„ μ μκ³ , λν• νλΌλ―Έν„° κ°’μ΄ λ‹¬λΌλ„ κ°™μ€ μΏΌλ¦¬λ΅ μΈμ‹ν•΄μ„ JPAλ” JPQLμ„ SQLλ΅ νμ‹±ν• κ²°κ³Όλ¥Ό μ¬μ‚¬μ©ν•  μ μλ‹¤. κ·Έλ¦¬κ³  λ°μ΄ν„°λ² μ΄μ¤λ„ λ‚΄λ¶€μ—μ„ μ‹¤ν–‰ν• SQLμ„ νμ‹±ν•΄μ„ μ‚¬μ©ν•λ”λ°, κ°™μ€ μΏΌλ¦¬λ” νμ‹±ν• κ²°κ³Όλ¥Ό μ¬μ‚¬μ©ν•  μ μλ‹¤.

### π“ν”„λ΅μ μ…
SELECT μ μ— μ΅°νν•  λ€μƒμ„ μ§€μ •ν•λ” κ²ƒμ„ ν”„λ΅μ μ…μ΄λΌ ν•κ³  `[SELECT {ν”„λ΅μ μ… λ€μƒ} FROM]`μΌλ΅ λ€μƒμ„ μ„ νƒν•λ‹¤.
ν”„λ΅μ μ… λ€μƒμ€ μ—”ν‹°ν‹°, μ„λ² λ””λ“ νƒ€μ…, μ¤μΉΌλΌ νƒ€μ…μ΄ μλ‹¤. 
μ¤μΉΌλΌ νƒ€μ…μ€ μ«μ, λ¬Έμ λ“± κΈ°λ³Έ λ°μ΄ν„° νƒ€μ…μ„ λ»ν•λ‹¤.

#### μ—”ν‹°ν‹° ν”„λ΅μ μ…
```java
SELECT m FROM Member m //νμ›
SELECT m FROM Member m //ν€
```
μ΄λ ‡κ² μ΅°νν• μ—”ν‹°ν‹°λ” μμ†μ„± μ»¨ν…μ¤νΈμ—μ„ κ΄€λ¦¬λλ‹¤.

#### μ„λ² λ””λ“ νƒ€μ… ν”„λ΅μ μ…
JPQL μ—μ„ μ„λ² λ””λ“ νƒ€μ…μ€ μ—”ν‹°ν‹°μ™€ κ±°μ λΉ„μ·ν•κ² μ‚¬μ©λλ‹¤. μ„λ² λ””λ“ νƒ€μ…μ€ μ΅°νμ μ‹μ‘μ μ΄ λ  μ μ—†λ‹¤λ” μ μ•½μ΄ μλ‹¤.
μλ¥Ό λ“¤μ–΄μ„...
```java
String query = "SELECT a FROM Address a";
```
μ„ μ½”λ“λ” μλ»λλ‹¤. Address νƒ€μ…μ€ μ„λ² λ””λ“ νƒ€μ…μ΄μ–΄μ„ μ‹μ‘μ΄ λ  μ μ—†λ‹¤.

λ‹¤μ μ½”λ“λ” μ¬λ°”λ¥Έ μ½”λ“μ΄λ‹¤.
```java
String query = "SELECT o.address FROM Order o";
List<Address> addresses = em.createQuery(query, Address.class).getResultList();
```
μ„ μ½”λ“λ¥Ό μ‹¤ν–‰ν•λ©΄ μ•„λ SQLμ΄ μ‹¤ν–‰λλ‹¤.
```sql
SELECT 
	CITY
    STREET
    ZIPCODE
FROM
	ORDERS 
```
μ„λ² λ””λ“ νƒ€μ…μ€ μ—”ν‹°ν‹° νƒ€μ…μ΄ μ•„λ‹ κ°’ νƒ€μ…μ΄κΈ° λ•λ¬Έμ—, μμ†μ„± μ»¨ν…μ¤νΈμ—μ„ κ΄€λ¦¬λμ§€ μ•λ”λ‹¤.
